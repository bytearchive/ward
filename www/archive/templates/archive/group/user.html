{% extends "base.html" %}
{% load staticfiles %}

{% block css %}
    <style type="text/css">
        /* Base */
        .visit_total {
            font-size: 15px;
        }

        .visit_total .title {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .visit_total .number {
            font-size: 20px;
        }

        .visit_total .chart {
            margin-top: 5px;
            height: 50px;
            width: 100px;
        }

        .bargauge {
            font-size: 15px;
        }

        .bargauge .title {
            padding: 16px;
        }

        .bargauge .chart {
            height: 150px;
            width: 80%;
        }

        .body {
            padding: 10px;
        }

        .dashed {
            border-top: 1px dashed #e5e5e5;

        }
    </style>
{% endblock %}

{% block header %}
    {% include 'archive/group/header.html' %}
{% endblock %}

{% block content %}
    <div class="container">
        <div class="menu">

            <div class="vmenu ">
                <a href="{% url 'archive:group_analysis' group.id %}"><i class="icon-profile"></i> Analysis</a>
                <a href="{% url 'archive:group_user' group.id %}" class="active"><i class="icon-user"></i> User</a>
                <a href="realtime.html"><i class="icon-realtime"></i> Realtime</a>
                <a href="analysis.html"><i class="icon-monitoring"></i> Dashboard</a>
                <a><i class="icon-chart"></i> Statistics</a>
                <a><i class="icon-document"></i> Document</a>
                <a><i class="icon-gear"></i> Management</a>
            </div>

        </div>
        <div class="content">

            <div class="content-list">
                <div class="dashboard-first">
                    <div class="col col-3">
                        <div class="card">
                            <div class="title">Total Posts</div>
                            <div class="value">{{ group.post_count }}</div>
                        </div>
                    </div>
                    <div class="col col-3">
                        <div class="card">
                            <div class="title">Total Comments</div>
                            <div class="value">{{ group.comment_count }}</div>
                        </div>

                    </div>
                    <div class="col col-3">
                        <div class="card">
                            <div class="title">Weekly Posts</div>
                            <div class="value">{{ posts|length }}</div>
                        </div>

                    </div>
                    <div class="col col-3">
                        <div class="card">
                            <div class="title">Last Updated</div>
                            <div class="value">{{ group.get_diff_time }}</div>
                        </div>

                    </div>
                </div>

                <div class="panel">
                    <div class="body">
                        <h1 class="title"><i class="icon-analysis2"></i> <strong>Activity</strong></h1>

                        <ul id="activity_tab" class="tab top">
                            <li>
                                <a href="#total">Total</a>
                            </li>
                            <li><a href="#Month">Month</a></li>
                            <li><a href="#week">Week</a></li>
                        </ul>

                        <div id="activity_tab_contents">
                            <div id="total"></div>
                            <div id="month"></div>
                            <div id="week"></div>
                        </div>
                        <div align="center">
                            <div class="col col-6">
                                <div class="panel" style="border:1px solid #ababab; border-radius: 10px; width: 90%;">
                                    <div class="head">
                                        <strong>Post Activity</strong>
                                    </div>
                                    <table id="post_activity_table" class="table simple normal borderless">
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col col-6">
                                <div class="panel" style="border:1px solid #ababab; border-radius: 10px; width: 90%;">
                                    <div class="head">
                                        <strong>Comment Activity</strong>
                                    </div>
                                    <table id="comment_activity_table" class="table simple normal borderless">
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <script id="tpl_row" type="text/template">
                    <tr>
                        <td style="text-align: right;"><!= picture !></td>
                        <td><!= from !></td>
                        <td><!= count !></td>
                    </tr>
                </script>

                <script id="tpl_none" type="text/template">
                    <tr>
                        <td colspan="2" class="none" align="center">Data does not exist.</td>
                    </tr>
                </script>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script src="{% static 'js/archive.js' %}" type="text/javascript"></script>
    <script>
        var activity_url = "/api/groups/{{ group.id }}/activity/";

        /**
         * Generate Activity
         */
        jui.ready(["uix.tab", "uix.table"], function (tab, table) {
            activity_tab = tab("#activity_tab", {
                event: {
                    change: function (data) {
                        getActivity(activity_url, 10, data.text.toLowerCase(), "post", post_activity_table);
                        getActivity(activity_url, 10, data.text.toLowerCase(), "comment", comment_activity_table);
                    }
                },
                target: "#activity_tab_contents",
                index: 0
            });

            post_activity_table = table("#post_activity_table", {
                tpl: {
                    row: $("#tpl_row").html(),
                    none: $("#tpl_none").html()
                }
            });

            comment_activity_table = table("#comment_activity_table", {
                tpl: {
                    row: $("#tpl_row").html(),
                    none: $("#tpl_none").html()
                }
            });
        });

        /**
         * Init user.html
         */
        $(function () {
            getActivity(activity_url, 10, "total", "post", post_activity_table);
            getActivity(activity_url, 10, "total", "comment", comment_activity_table);
        });
    </script>
{% endblock %}
