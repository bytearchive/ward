{% extends "base.html" %}
{% load staticfiles %}

{% block css %}
{% endblock %}

{% block sidebar %}
    {% include 'archive/group/sidebar.html' %}
{% endblock %}

{% block content %}
    <div id="page-wrapper">

        {% block header %}
            {% include 'archive/group/archive_header.html' %}
        {% endblock %}

        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-key fa-fw"></i> Access Token
                        <div class="pull-right">
                            <div class="btn-group">
                                <button class="btn btn-danger btn-xs" data-toggle="modal" data-target="#help">
                                    <i class="fa fa-question fa-fw"></i> help
                                </button>
                                <!-- Modal -->
                                <div class="modal fade" id="help" tabindex="-1" role="dialog"
                                     aria-labelledby="help_label" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"
                                                        aria-hidden="true">&times;</button>
                                                <h4 class="modal-title" id="help_label">How to get access token?</h4>
                                            </div>
                                            <div class="modal-body">
                                                <ol>
                                                    <li>
                                                        Go to this <a target='_blank'
                                                                      href='https://developers.facebook.com/tools/explorer/'>link</a>
                                                    </li>
                                                    <li>
                                                        Copy the access token in graph api explorer.
                                                    </li>
                                                    <li>
                                                        Paste the access token in our site.
                                                    </li>
                                                </ol>
                                                <b><p style='color:#ff1493;'>Our site does not save this access token.
                                                    It only use to access graph api once.</p></b>
                                            </div>
                                        </div>
                                        <!-- /.modal-content -->
                                    </div>
                                    <!-- /.modal-dialog -->
                                </div>
                                <!-- /.modal -->
                            </div>
                        </div>
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body">
                        <input type="text" class="input" id="access_token" name="access_token"
                               placeholder="Please Input Access Token"
                               style="width: 100%;"/>
                    </div>
                    <!-- /.panel-body -->
                </div>
            </div>

            <div class="col-lg-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-list fa-fw"></i> Post
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-xs dropdown-toggle"
                                        data-toggle="dropdown">
                                    Actions
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    <li style="text-align: center;">
                                        <label for="post_limit">Limit</label>
                                        <input type="text" class="input" id="post_limit" placeholder="Limit"
                                               value="20" style="width: 80%; text-align: center;"/>
                                    </li>
                                    <li class="divider"></li>
                                    <li style="text-align: center;">
                                        <div id="post_radio" style="margin-bottom: 10px;">
                                            <a class="btn btn-default btn-xs" value="text">Text</a>
                                            <a class="btn btn-default btn-xs" value="user">User</a>
                                        </div>
                                    </li>
                                    <li style="text-align: center;">
                                        <input type="text" class="input" id="post_search" placeholder="Search"
                                               style="width: 80%; text-align: center;"/>
                                    </li>
                                    <li class="divider"></li>
                                    <li>
                                        <a id="post_del_btn">Delete</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body jui">
                        <form id="post_del_form" action="" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="model" value="post">
                            <table id="post_table" class="table simple hover borderless">
                                <colgroup>
                                    <col style="width: 20px;">
                                    <col style="width: 60px;">
                                    <col style="width: 100px;">
                                    <col style="width: 60%;">
                                    <col style="width: 20%;">
                                    <col style="width: 20%;">
                                </colgroup>
                                <thead>
                                <tr>
                                    <th style="text-align: center;">
                                        <input type="checkbox" id="check_all_post"
                                               style="display: inline-block;">
                                    </th>
                                    <th></th>
                                    <th><i class="icon-user"></i> From</th>
                                    <th style="text-align: center;"><i class="icon-report"></i> Message</th>
                                    <th style="text-align: center;"><i class="icon-like"></i> Like</th>
                                    <th style="text-align: center;"><i class="icon-message"></i> Comment
                                    </th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </form>

                        <div id="post_paging" class="paging" style="margin-top: 3px;">
                            <a href="#" class="prev">Previous</a>

                            <div class="list"></div>
                            <a href="#" class="next">Next</a>
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
            </div>

            <div class="col-lg-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-comments fa-fw"></i> Comment
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-xs dropdown-toggle"
                                        data-toggle="dropdown">
                                    Actions
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    <li style="text-align: center;">
                                        <label for="comment_limit">Limit</label>
                                        <input type="text" class="input" id="comment_limit" placeholder="Limit"
                                               value="20" style="width: 80%; text-align: center;"/>
                                    </li>
                                    <li class="divider"></li>
                                    <li style="text-align: center;">
                                        <div id="comment_radio" style="margin-bottom: 10px;">
                                            <a class="btn btn-default btn-xs" value="text">Text</a>
                                            <a class="btn btn-default btn-xs" value="user">User</a>
                                        </div>
                                    </li>
                                    <li style="text-align: center;">
                                        <input type="text" class="input" id="comment_search"
                                               placeholder="Search" style="width: 80%; text-align: center;"/>
                                    </li>
                                    <li class="divider"></li>
                                    <li>
                                        <a id="comment_del_btn">Delete</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body jui">
                        <form id="comment_del_form" action="" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="model" value="comment">
                            <table id="comment_table" class="table simple hover borderless">
                                <colgroup>
                                    <col style="width: 20px;">
                                    <col style="width: 60px;">
                                    <col style="width: 100px;">
                                    <col style="width: 60%;">
                                    <col style="width: 20%;">
                                    <col style="width: 20%;">
                                </colgroup>
                                <thead>
                                <tr>
                                    <th style="text-align: center;">
                                        <input type="checkbox" id="check_all_comment"
                                               style="display: inline-block;">
                                    </th>
                                    <th></th>
                                    <th><i class="icon-user"></i> From</th>
                                    <th style="text-align: center;"><i class="icon-report"></i> Message</th>
                                    <th style="text-align: center;"><i class="icon-like"></i> Like</th>
                                    <th style="text-align: center;"><i class="icon-message"></i> Comment
                                    </th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </form>

                        <div id="comment_paging" class="paging" style="margin-top: 3px;">
                            <a href="#" class="prev">Previous</a>

                            <div class="list"></div>
                            <a href="#" class="next">Next</a>
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
            </div>
        </div>
        <!-- /.row -->

        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-user fa-fw"></i> User
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-xs dropdown-toggle"
                                        data-toggle="dropdown">
                                    Actions
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    <li style="text-align: center;">
                                        <label for="user_limit">Limit</label>
                                        <input type="text" class="input" id="user_limit" placeholder="Limit"
                                               value="10" style="width: 80%; text-align: center;"/>
                                    </li>
                                    <li class="divider"></li>
                                    <li style="text-align: center;">
                                        <input type="text" class="input" id="user_search" placeholder="Search"
                                               style="width: 80%; text-align: center;"/>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body jui">
                        <table id="user_table" class="table simple hover borderless">
                            <thead>
                            <tr>
                                <th></th>
                                <th><i class="icon-user"></i> User</th>
                                <th style="text-align: center;"><i class="icon-report"></i> Post</th>
                                <th style="text-align: center;"><i class="icon-message"></i> Comment</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>

                        <div id="user_paging" class="paging" style="margin-top: 3px;">
                            <a href="#" class="prev">Previous</a>

                            <div class="list"></div>
                            <a href="#" class="next">Next</a>
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
            </div>
        </div>
        <!-- /.row -->

        <!-- /.row -->
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-user fa-fw"></i> Blacklist
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-xs dropdown-toggle"
                                        data-toggle="dropdown">
                                    Actions
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    <li style="text-align: center;">
                                        <label for="blacklist_limit">Limit</label>
                                        <input type="text" class="input" id="blacklist_limit" placeholder="Limit"
                                               value="10" style="width: 80%; text-align: center;"/>
                                    </li>
                                    <li class="divider"></li>
                                    <li style="text-align: center;">
                                        <input type="text" class="input" id="blacklist_search" placeholder="Search"
                                               style="width: 80%; text-align: center;"/>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- /.panel-heading -->
                    <div class="panel-body jui">
                        <table id="blacklist_table" class="table simple hover borderless">
                            <thead>
                            <tr>
                                <th></th>
                                <th><i class="icon-user"></i> User</th>
                                <th style="text-align: center;"><i class="icon-caution"></i> Spam</th>
                                <th style="text-align: center;"><i class="icon-report"></i> Post</th>
                                <th style="text-align: center;"><i class="icon-message"></i> Comment</th>
                                <th style="text-align: center;"><i class="icon-realtime"></i> Updated Time</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>

                        <div id="blacklist_paging" class="paging" style="margin-top: 3px;">
                            <a href="#" class="prev">Previous</a>

                            <div class="list"></div>
                            <a href="#" class="next">Next</a>
                        </div>
                    </div>
                    <!-- /.panel-body -->
                </div>
            </div>
        </div>
        <!-- /.row -->

        <script id="tpl_row" type="text/template">
            <tr>
                <td style="text-align: right;"><!= checkbox !></td>
                <td style="text-align: right;"><!= picture !></td>
                <td><!= from !></td>
                <td><!= message !></td>
                <td style="text-align: center;"><!= like_count !></td>
                <td style="text-align: center;"><!= comment_count !></td>
            </tr>
        </script>

        <script id="tpl_none" type="text/template">
            <tr>
                <td colspan="6" class="none" align="center">Data does not exist.</td>
            </tr>
        </script>

        <script id="tpl_pages" type="text/template">
            <! for(var i = 0; i < pages.length; i++) { !>
            <a href="#" class="page"><!= pages[i] !></a>
            <! } !>
        </script>

        <script id="tpl_row2" type="text/template">
            <tr>
                <td style="text-align: right;"><!= picture !></td>
                <td><!= from !></td>
                <td style="text-align: center;"><!= post_count !></td>
                <td style="text-align: center;"><!= comment_count !></td>
            </tr>
        </script>

        <script id="tpl_none2" type="text/template">
            <tr>
                <td colspan="5" class="none" align="center">Data does not exist.</td>
            </tr>
        </script>

        <script id="tpl_row3" type="text/template">
            <tr>
                <td style="text-align: right;"><!= picture !></td>
                <td><!= from !></td>
                <td style="text-align: center;"><!= count !></td>
                <td style="text-align: center;"><!= post_count !></td>
                <td style="text-align: center;"><!= comment_count !></td>
                <td style="text-align: center;"><!= updated_time !></td>
            </tr>
        </script>

        <script id="tpl_none3" type="text/template">
            <tr>
                <td colspan="6" class="none" align="center">Data does not exist.</td>
            </tr>
        </script>

        <div id="loading_post_msg" style="display: none; font-size: 20px; color: red;">
            NOW LOADING...
        </div>

        <div id="loading_comment_msg" style="display: none; font-size: 20px; color: red;">
            NOW LOADING...
        </div>

        <div id="loading_user_msg" style="display: none; font-size: 20px; color: red;">
            NOW LOADING...
        </div>

        <div id="loading_blacklist_msg" style="display: none; font-size: 20px; color: red;">
            NOW LOADING...
        </div>

        <div id="loading_user_search_helper_msg" style="display: none; font-size: 20px; color: red;">
            NOW LOADING...
        </div>

        <div id="modal_1" class="msgbox jui" style="display: none; width: 400px;">
            <div class="body">
                <div style="background: #ffffff;">
                    <table id="user_search_helper_table" class="table simple hover borderless">
                        <thead>
                        <tr>
                            <th colspan="2" style="text-align: center;"><i class="icon-user"></i> User</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div id="user_search_helper_paging" class="paging" style="margin-top: 3px;">
                        <a href="#" class="prev">Previous</a>

                        <div class="list"></div>
                        <a href="#" class="next">Next</a>
                    </div>

                    <input id="user_search_helper_search" type="text" class="input small"
                           placeholder="Search"
                           style="text-align: center; width: 100%;"/>
                </div>
            </div>

            <script id="tpl_row4" type="text/template">
                <tr>
                    <td style="text-align: center;"><!= picture !></td>
                    <td><!= from !></td>
                </tr>
            </script>

            <script id="tpl_none4" type="text/template">
                <tr>
                    <td colspan="2" class="none" align="center">Data does not exist.</td>
                </tr>
            </script>
        </div>
    </div><!-- /.page-wrapper -->
{% endblock %}


{% block script %}
    <script src="{% static 'js/archive/js/user.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/archive/js/management.js' %}" type="text/javascript"></script>
    <script>
        var group_id = "{{ group.id }}";

        var post_limit = 20;
        var comment_limit = 20;
        var user_limit = 10;
        var search_limit = 10;

        var post_search = $('#post_search');
        var comment_search = $('#comment_search');
        var user_search = $('#user_search');
        var blacklist_search = $('#blacklist_search');
        var user_search_helper_search = $('#user_search_helper_search');

        var post_search_url = "/api/groups/{{ group.id }}/post_search/";
        var comment_search_url = "/api/groups/{{ group.id }}/comment_search/";
        var user_search_url = "/api/groups/{{ group.id }}/user_archive/";
        var blacklist_search_url = "/api/groups/{{ group.id }}/blacklist_search/";

        var post_search_check = 'text';
        var comment_search_check = 'text';
        var user_search_helper_check = 'post';

        /**
         * Generate Archive
         */
        jui.ready(["ui.paging", "uix.table"], function (paging, table) {
            post_paging = paging("#post_paging", {
                pageCount: 10,
                screenCount: detectWidthToScreenCount(),
                event: {
                    page: function (pNo) {
                        changeSearchPCM(post_search_url, post_table, post_limit, 'post', post_search.val(), post_search_check, loading_post, pNo);
                    }
                },
                tpl: {
                    pages: $("#tpl_pages").html(),
                }
            });

            post_table = table("#post_table", {
                fields: ["", "", "from", "message", "like_count", "comment_count"],
                scroll: true,
                scrollHeight: 2500,
                resize: true,
                event: {
                    sort: function (column, e) {
                        var className = {
                            "desc": "icon-arrow1",
                            "asc": "icon-arrow3"
                        }[column.order];

                        $(column.element).children("i").remove();
                        $(column.element).append("<i class='" + className + "'></i>");
                    }
                },
                tpl: {
                    row: $("#tpl_row").html(),
                    none: $("#tpl_none").html()
                }
            });

            comment_paging = paging("#comment_paging", {
                pageCount: 10,
                screenCount: detectWidthToScreenCount(),
                event: {
                    page: function (pNo) {
                        changeSearchPCM(comment_search_url, comment_table, comment_limit, 'comment', comment_search.val(), comment_search_check, loading_comment, pNo);
                    }
                },
                tpl: {
                    pages: $("#tpl_pages").html()
                }
            });

            comment_table = table("#comment_table", {
                fields: ["", "", "from", "message", "like_count", "comment_count"],
                scroll: true,
                scrollHeight: 2500,
                resize: true,
                event: {
                    sort: function (column, e) {
                        var className = {
                            "desc": "icon-arrow1",
                            "asc": "icon-arrow3"
                        }[column.order];

                        $(column.element).children("i").remove();
                        $(column.element).append("<i class='" + className + "'></i>");
                    }
                },
                tpl: {
                    row: $("#tpl_row").html(),
                    none: $("#tpl_none").html()
                }
            });

            user_paging = paging("#user_paging", {
                pageCount: 10,
                screenCount: detectWidthToScreenCount(),
                event: {
                    page: function (pNo) {
                        changeUserArchive(user_search_url, group_id, user_table, user_limit, user_search.val(), loading_user, pNo);
                    }
                },
                tpl: {
                    pages: $("#tpl_pages").html()
                }
            });

            user_table = table("#user_table", {
                fields: ["", "from", "post_count", "comment_count"],
                scroll: true,
                scrollHeight: 2000,
                resize: true,
                event: {
                    sort: function (column, e) {
                        var className = {
                            "desc": "icon-arrow1",
                            "asc": "icon-arrow3"
                        }[column.order];

                        $(column.element).children("i").remove();
                        $(column.element).append("<i class='" + className + "'></i>");
                    }
                },
                tpl: {
                    row: $("#tpl_row2").html(),
                    none: $("#tpl_none2").html()
                }
            });

            blacklist_paging = paging("#blacklist_paging", {
                pageCount: 10,
                screenCount: detectWidthToScreenCount(),
                event: {
                    page: function (pNo) {
                        changeSearchBM(blacklist_search_url, group_id, blacklist_table, search_limit, blacklist_search.val(), loading_blacklist, pNo);
                    }
                },
                tpl: {
                    pages: $("#tpl_pages").html()
                }
            });

            blacklist_table = table("#blacklist_table", {
                fields: ["", "from", "count", "post_count", "comment_count", "updated_time"],
                scroll: true,
                scrollHeight: 2000,
                resize: true,
                event: {
                    sort: function (column, e) {
                        var className = {
                            "desc": "icon-arrow1",
                            "asc": "icon-arrow3"
                        }[column.order];

                        $(column.element).children("i").remove();
                        $(column.element).append("<i class='" + className + "'></i>");
                    }
                },
                tpl: {
                    row: $("#tpl_row3").html(),
                    none: $("#tpl_none3").html()
                }
            });

            user_search_helper_paging = paging("#user_search_helper_paging", {
                pageCount: 10,
                screenCount: 5,
                event: {
                    page: function (pNo) {
                        changeSearchUM(user_search_url, user_search_helper_table, 5, user_search_helper_search.val(), loading_user_search_helper, pNo);
                    }
                },
                tpl: {
                    pages: $("#tpl_pages").html()
                }
            });

            user_search_helper_table = table("#user_search_helper_table", {
                fields: ["", "from"],
                scroll: true,
                scrollHeight: 2000,
                resize: true,
                event: {
                    sort: function (column, e) {
                        var className = {
                            "desc": "icon-arrow1",
                            "asc": "icon-arrow3"
                        }[column.order];

                        $(column.element).children("i").remove();
                        $(column.element).append("<i class='" + className + "'></i>");
                    }
                },
                tpl: {
                    row: $("#tpl_row4").html(),
                    none: $("#tpl_none4").html()
                }
            });
        });

        /**
         * Generate Helper
         */
        jui.ready(["ui.modal", "ui.tooltip"], function (modal, tooltip) {
            $("#modal_1").appendTo("body");

            modal_1 = modal("#modal_1", {
                color: "black"
            });
        });

        /**
         * Generate Button
         */
        jui.ready(["ui.button"], function (button) {
            function user_clicked(model) {
                user_search_helper_check = model;

                modal_1.show();
                changeSearchUM(user_search_url, user_search_helper_table, 5, user_search_helper_search.val(), loading_user_search_helper, 1, user_search_helper_paging);
            }

            post_radio = button("#post_radio", {
                type: "radio",
                index: 0,
                event: {
                    change: function (data) {
                        post_search_check = data.value;
                        if (data.value == 'user') user_clicked('post');
                    }
                }
            });

            comment_radio = button("#comment_radio", {
                type: "radio",
                index: 0,
                event: {
                    change: function (data) {
                        comment_search_check = data.value;
                        if (data.value == 'user') user_clicked('comment');
                    }
                }
            });
        });

        /**
         * Loading message
         */
        jui.ready(["ui.modal"], function (modal) {
            loading_post = modal("#loading_post_msg", {
                target: "#post_table",
                opacity: 0.5,
                color: 'white',
                autoHide: false,
            });

            loading_comment = modal("#loading_comment_msg", {
                target: "#comment_table",
                opacity: 0.5,
                color: 'white',
                autoHide: false,
            });

            loading_user = modal("#loading_user_msg", {
                target: "#user_table",
                opacity: 0.5,
                color: 'white',
                autoHide: false,
            });

            loading_blacklist = modal("#loading_blacklist_msg", {
                target: "#blacklist_table",
                opacity: 0.5,
                color: 'white',
                autoHide: false,
            });

            loading_user_search_helper = modal("#loading_user_search_helper_msg", {
                target: "#user_search_helper_table",
                opacity: 0.5,
                color: 'white',
                autoHide: false,
            });
        });

        /**
         * Init analysis.html
         */
        $(function () {
            changeSearchPCM(post_search_url, post_table, post_limit, 'post', post_search.val(), post_search_check, loading_post, 1, post_paging);
            changeSearchPCM(comment_search_url, comment_table, comment_limit, 'comment', comment_search.val(), comment_search_check, loading_comment, 1, comment_paging);
            changeUserArchive(user_search_url, group_id, user_table, user_limit, user_search.val(), loading_user, 1, user_paging);
            changeSearchBM(blacklist_search_url, group_id, blacklist_table, search_limit, blacklist_search.val(), loading_blacklist, 1, blacklist_paging);

            /**
             * Window Resize
             */
            window.onresize = function (event) {
                post_table.resize();
                comment_table.resize();
                user_table.resize();
                blacklist_table.resize();
                reLoadPaging(post_paging);
                reLoadPaging(comment_paging);
                reLoadPaging(user_paging);
                reLoadPaging(blacklist_paging);
            }

            /**
             * Mobile Rotate
             */
            $(window).on("orientationchange", function () {
                changeSearchPCM(post_search_url, post_table, post_limit, 'post', post_search.val(), post_search_check, loading_post, 1, post_paging);
                changeSearchPCM(comment_search_url, comment_table, comment_limit, 'comment', comment_search.val(), comment_search_check, loading_comment, 1, comment_paging);
                changeUserArchive(user_search_url, group_id, user_table, user_limit, user_search.val(), loading_user, 1, user_paging);
                changeSearchBM(blacklist_search_url, group_id, blacklist_table, search_limit, blacklist_search.val(), loading_blacklist, 1, blacklist_paging);
            });

            $("#post_limit").on("input", function () {
                post_limit = $("#post_limit").val();
                changeSearchPCM(post_search_url, post_table, post_limit, 'post', post_search.val(), post_search_check, loading_post, 1, post_paging);

            });

            $("#comment_limit").on("input", function () {
                comment_limit = $("#comment_limit").val();
                changeSearchPCM(comment_search_url, comment_table, comment_limit, 'comment', comment_search.val(), comment_search_check, loading_comment, 1, comment_paging);
            });

            $("#user_limit").on("input", function () {
                user_limit = $("#user_limit").val();
                changeUserArchive(user_search_url, group_id, user_table, user_limit, user_search.val(), loading_user, 1, user_paging);
            });

            $("#blacklist_limit").on("input", function () {
                user_limit = $("#blacklist_limit").val();
                changeSearchBM(blacklist_search_url, group_id, blacklist_table, search_limit, blacklist_search.val(), loading_blacklist, 1, blacklist_paging);
            });

            $("#post_search").keypress(function (event) {
                var key_code = event.keyCode || window.event.keyCode;
                if (key_code == 13) {
                    changeSearchPCM(post_search_url, post_table, post_limit, 'post', post_search.val(), post_search_check, loading_post, 1, post_paging);
                }
            });

            $("#comment_search").keypress(function (event) {
                var key_code = event.keyCode || window.event.keyCode;
                if (key_code == 13) {
                    changeSearchPCM(comment_search_url, comment_table, comment_limit, 'comment', comment_search.val(), comment_search_check, loading_comment, 1, comment_paging);
                }
            });

            $("#user_search").keypress(function (event) {
                var key_code = event.keyCode || window.event.keyCode;
                if (key_code == 13) {
                    changeUserArchive(user_search_url, group_id, user_table, user_limit, user_search.val(), loading_user, 1, user_paging);
                }
            });

            $("#blacklist_search").keypress(function (event) {
                var key_code = event.keyCode || window.event.keyCode;
                if (key_code == 13) {
                    changeSearchBM(blacklist_search_url, group_id, blacklist_table, search_limit, blacklist_search.val(), loading_blacklist, 1, blacklist_paging);
                }
            });

            $("#user_search_helper_search").keypress(function (event) {
                var key_code = event.keyCode || window.event.keyCode;
                if (key_code == 13) {
                    changeSearchUM(user_search_url, user_search_helper_table, 5, user_search_helper_search.val(), loading_user_search_helper, 1, user_search_helper_paging);
                }
            });

            /**
             * check all
             */
            $("#check_all_post").click(function () {
                if ($("#check_all_post").prop("checked")) {
                    $("input[name=del_post]").prop("checked", true);
                } else {
                    $("input[name=del_post]").prop("checked", false);
                }
            });

            $("#check_all_comment").click(function () {
                if ($("#check_all_comment").prop("checked")) {
                    $("input[name=del_comment]").prop("checked", true);
                } else {
                    $("input[name=del_comment]").prop("checked", false);
                }
            });

            /**
             * delete checked objects
             */
            $("#post_del_btn").on("click", function () {
                var data = $("#post_del_form").serialize();
                data += "&access_token=" + encodeURIComponent($("#access_token").val());    // add access token in from
                var answer = confirm("Are you sure delete?")
                if (answer) {
                    deleteAjax(data);
                    changeSearchPCM(post_search_url, post_table, post_limit, 'post', post_search.val(), post_search_check, loading_post, 1, post_paging);
                    changeSearchPCM(comment_search_url, comment_table, comment_limit, 'comment', comment_search.val(), comment_search_check, loading_comment, 1, comment_paging);
                }

            });

            $("#comment_del_btn").on("click", function () {
                var data = $("#comment_del_form").serialize();
                data += "&access_token=" + encodeURIComponent($("#access_token").val());    // add access token in from
                var answer = confirm("Are you sure delete?")
                if (answer) {
                    deleteAjax(data);
                    changeSearchPCM(comment_search_url, comment_table, comment_limit, 'comment', comment_search.val(), comment_search_check, loading_comment, 1, comment_paging);
                }
            });
        });

        /**
         * Delete checked objects
         *
         * @param data
         */
        function deleteAjax(data) {
            $.ajax({
                url: '{% url 'archive:group_management' group.id %}',
                type: "post",
                async: false,
                data: data,
                success: function (json, status) {
                    if (json["result"]) {
                        var title = '';
                        var error_text = '<br>';
                        var color = 'success';

                        var result = json["result"];
                        var error = json["error"];
                        if (result["success"] > 0) {
                            title = 'Successfully deleted ' + result["success"] + ' ' + json["model"];
                            if (result["success"] > 1) {
                                title += 's'
                            }
                            var total = '. (' + result["success"] + '/' + result["total"] + ')';
                            title += total;
                        } else {
                            title = 'Failed to delete ' + result["fail"] + ' ' + json["model"];
                            if (result["fail"] > 1) {
                                title += 's'
                            }
                            var total = '. (' + result["fail"] + '/' + result["total"] + ')';
                            title += total;
                            color = 'danger';
                        }

                        if (error.length > 0) {
                            for (var i in error) {
                                error_text += error[i];
                                error_text += '<br>';
                            }
                        }
                        data = {
                            title: title,
                            message: getToday() + error_text,
                            color: color,
                        }
                        notify_top_submit(1, data);
                    }
                    else if (json["error"]) {
                        data = {
                            title: json["error"],
                            message: getToday(),
                            color: 'danger',
                        }
                        notify_top_submit(1, data);
                    }
                },
                error: function (request, status, error) {
                    data = {
                        title: "An unexpected error has occurred.",
                        message: getToday(),
                        color: 'danger',
                    }
                    notify_top_submit(1, data);
                }
            });
        }

        /**
         * Reset posts and comments by selected user.
         *
         * @param user_id
         */
        function searchUMSelect(user_id) {
            if (user_search_helper_check == "post") {
                post_search.val(user_id);
                changeSearchPCM(post_search_url, post_table, post_limit, 'post', post_search.val(), post_search_check, loading_post, 1, post_paging);
            }
            else {
                comment_search.val(user_id);
                changeSearchPCM(comment_search_url, comment_table, comment_limit, 'comment', comment_search.val(), comment_search_check, loading_comment, 1, comment_paging);
            }
        }
    </script>
{% endblock %}
